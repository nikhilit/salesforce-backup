<template>
    <lightning-card title="Search Accounts">
        <div class="slds-p-around_medium">
            <!-- Search Input Field -->
            <lightning-input 
                label="Search" 
                value={searchKey} 
                onchange={handleSearch}
                placeholder="Search Accounts..."
                class="slds-m-bottom_medium">
            </lightning-input>
        </div>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
        </template>

        <!-- Data Table -->
        <div class="slds-m-bottom_medium">
            <lightning-datatable 
                data={pagedData} 
                columns={columns} 
                key-field="Id"
                show-row-number-column
                onsort={handleSort}
                onrowaction={handleRowAction}
                selected-rows={selectedRows}
                onrowselection={handleRowSelection}>
            </lightning-datatable>
        </div>

        <!-- Pagination Controls -->
        <div class="slds-p-around_medium">
            <div class="slds-grid slds-grid_vertical-align-center slds-grid_align-spread">
                <!-- Previous Button -->
                <lightning-button 
                    label="Previous" 
                    onclick={handlePrevPage} 
                    disabled={isPrevDisabled}
                    class="slds-button_neutral">
                </lightning-button>

                <!-- Page Number Input -->
                <div class="slds-text-align_center">
                    <lightning-input 
                        label="Page Number" 
                        value={currentPage} 
                        onchange={handlePageChange} 
                        type="number" 
                        min="1" 
                        max={totalPages}
                        class="slds-p-horizontal_small">
                    </lightning-input>
                    <span>of {totalPages} pages</span>
                </div>

                <!-- Next Button -->
                <lightning-button 
                    label="Next" 
                    onclick={handleNextPage} 
                    disabled={isNextDisabled}
                    class="slds-button_neutral">
                </lightning-button>
            </div>
        </div>

        <!-- Export Buttons -->
        <div class="slds-text-align_center slds-p-around_medium">
            <lightning-button 
                label="Export Selected as CSV" 
                onclick={exportSelectedAsCsv}
                variant="brand"
                class="slds-m-right_small"
                title="Export Selected as CSV">
            </lightning-button>
            <lightning-button 
                label="Export All as JSON" 
                onclick={exportAllAsJson}
                variant="brand"
                title="Export All as JSON">
            </lightning-button>
        </div>
    </lightning-card>

    <!-- Modal for Contacts -->
    <template if:true={isModalOpen}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Modal Header -->
                <header class="slds-modal__header">
                    <h2 id="modal-heading-01" class="slds-text-heading_medium">Related Contacts</h2>
                    <button class="slds-button slds-button_icon slds-modal__close" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close" size="small" title="Close"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                </header>

                <!-- Modal Body -->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <lightning-datatable
                        data={contacts}
                        columns={contactColumns}
                        key-field="Id"
                        onrowaction={handleContactAction}>
                    </lightning-datatable>
                </div>

                <!-- Modal Footer -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={closeModal}>Close</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>